window.__PRESSELL_BUILD_QUERY__=function(e,n){const o=window.__PRESSELL_SEQUENCE_KEYS__||[],t=[],r=new Set,a=new Set,i=(e,n)=>{let o=e||n;if(!o)return null;let t=o,r=1;for(;a.has(t);)r+=1,t=`${o}_${r}`;return t};if(e){const o=(window.__PRESSELL_KEY_MAP__||{})[e]||e,l=i(o,e);l&&(t.push({key:l,value:n[e]}),a.add(l)),r.add(e)}let l=0;return Object.keys(n).forEach(e=>{if(r.has(e))return;let c=null;for(;l<o.length&&!c;){const e=o[l];l+=1,e&&!a.has(e)&&(c=e)}c||(c=e);const s=i(c,e);s&&(t.push({key:s,value:n[e]}),r.add(e),a.add(s))}),t},function(){const e=["gclid","msclkid","fbclid"],n="minerx",o="presell_params",t="presell_params_expiry",r=[/googlebot\//i,/bingbot/i,/facebookexternalhit\//i,/pageburst/i],a="undefined"!=typeof window&&window.__PRESSELL_KEY_MAP__||{};let i={};const l="[presell-param-all]";function c(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(n){return e}}function s(e,n){return"tid"===e?function(e){return String(e).replace(/ /g,"_s_").replace(/-/g,"_d_").replace(/\//g,"")}(n):String(n)}function u(e){if(!e)return"";const n=a[e];return n?String(n):e}function f(n){if(!n||"object"!=typeof n)return[];const o={};Object.keys(n).forEach(e=>{if(!e)return;const t=n[e];null!=t&&""!==t&&(o[e]=s(e,t))});const t=Object.keys(o);if(!t.length)return[];const r=function(n){for(let o=0;o<e.length;o+=1){const t=e[o],r=n[t];if(null!=r&&""!==r)return t}return null}(o),a="undefined"!=typeof window&&"function"==typeof window.__PRESSELL_BUILD_QUERY__?window.__PRESSELL_BUILD_QUERY__:null;if(a)try{const e=a(r,o);if(Array.isArray(e)){const n=new Set;return e.map(e=>{if(!e||"object"!=typeof e)return null;const o=e.key&&String(e.key).trim()?String(e.key).trim():null,t=void 0!==e.value&&null!==e.value?String(e.value):"";return o&&""!==t?n.has(o)?null:(n.add(o),{key:o,value:t}):null}).filter(Boolean)}}catch(e){console.warn(l,"Falha ao executar builder de sequência customizado.",e)}const i=[],c=new Set,f=(e,n)=>{e&&""!==n&&!c.has(e)&&(i.push({key:e,value:String(n)}),c.add(e))};if(r){const e=u(r)||String(r).trim();f(e,o[r])}return t.forEach(e=>{if(e===r)return;const n=u(e)||String(e).trim();f(n,o[e])}),i}function d(e){return e?`${n}_${e}`:null}function p(e){return e?`${n}_${e}__expiry`:null}function m(e,n){const r=d(e),a=p(e);if(r&&a)try{window.localStorage.setItem(r,JSON.stringify(n)),window.localStorage.setItem(a,String(Date.now()+2592e6)),window.localStorage.removeItem(o),window.localStorage.removeItem(t)}catch(e){console.warn(l,"Falha ao salvar parâmetros no localStorage.",e)}else console.warn(l,"Namespace inválido para salvar parâmetros.")}function h(e,n){if(!e)return!1;if(!n)return!0;try{return new URL(e,window.location&&window.location.href),!0}catch(e){return console.warn(l,"Não foi possível analisar a URL alvo. Ignorando item.",e),!1}}function g(e,n,o,t=null){const r=Array.isArray(t)?t:f(n);if(!r.length)return e;if(!o)return w(e,r);try{const n=new URL(e,window.location&&window.location.href);return r.forEach(e=>{e&&e.key&&(n.searchParams.has(e.key)||n.searchParams.set(e.key,e.value))}),n.toString()}catch(n){return console.warn(l,"Falha ao anexar parâmetros via URL API. Usando fallback.",n),w(e,r)}}function w(e,n){const[o,t=""]=e.split("#"),r=t?`#${t}`:"",a=-1!==o.indexOf("?"),i=[],l=new Set;if(n.forEach(e=>{if(!e||!e.key||""===e.value)return;if(l.has(e.key))return;if(function(e,n){if(!n)return!1;return new RegExp(`[?&]${o=n,String(o).replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(=|&|$)`,"i").test(e);var o}(o,e.key))return;const n=encodeURIComponent(e.value);i.push(`${encodeURIComponent(e.key)}=${n}`),l.add(e.key)}),!i.length)return e;return`${o}${a?"&":"?"}${i.join("&")}${r}`}function y(e,n,o,t){const r=e.match(/^function\s*[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/);if(!r)return console.warn(l,"Não foi possível interpretar o handler do botão."),null;const a=r[1].trim(),i=r[2].replace(o,t),c=a?a.split(",").map(e=>e.trim()).filter(Boolean):[];try{return Function.apply(null,[...c,i])}catch(e){return console.warn(l,"Erro ao reconstruir o handler do botão.",e),n}}try{!function(){console.log(l,"Iniciando propagação de parâmetros.");const e=function(){if("undefined"==typeof window||!window.location)return null;const{hostname:e,pathname:n}=window.location,o="string"==typeof e&&e.trim()?e.trim().toLowerCase():"localhost",t=function(e){if("string"!=typeof e||!e.trim())return"/";let n=e.trim();return n.startsWith("/")||(n=`/${n}`),n=n.replace(/\/+$/,""),n||"/"}(n);return"/"===t?o:`${o}${t}`}();if(e||console.warn(l,"Não foi possível determinar namespace atual."),function(e){if(!e||"string"!=typeof e)return!1;const n=e.toLowerCase();return r.some(e=>e.test(n))}(window.navigator&&window.navigator.userAgent))return void console.log(l,"Agente identificado como crawler. Execução interrompida.");const n="function"==typeof URL&&"function"==typeof URLSearchParams,a=function(e){if(!e)return{};const n={};let o;try{o=new URLSearchParams(e)}catch(n){return console.warn(l,"URLSearchParams indisponível. Realizando parse manual.",n),function(e){const n={};return("?"===e.charAt(0)?e.slice(1):e).split("&").forEach(e=>{if(!e)return;const[o,t=""]=e.split("="),r=c(o);r&&(n[r]=c(t))}),n}(e)}return o.forEach((e,o)=>{null!==e&&o&&(n[o]=c(e))}),n}(window.location&&window.location.search);console.log(l,"Parâmetros detectados na URL atual:",a);let s=Object.keys(a).length?a:function(e){const n=[];e&&n.push({dataKey:d(e),expiryKey:p(e),migrateToNamespace:!1}),n.push({dataKey:o,expiryKey:t,migrateToNamespace:e});for(let r=0;r<n.length;r+=1){const a=n[r];try{const n=window.localStorage.getItem(a.expiryKey),r=window.localStorage.getItem(a.dataKey);if(!n||!r)continue;const i=parseInt(n,10);if(Number.isNaN(i)||Date.now()>i){window.localStorage.removeItem(a.dataKey),window.localStorage.removeItem(a.expiryKey);continue}const l=JSON.parse(r);if(l&&"object"==typeof l)return a.migrateToNamespace&&e&&a.dataKey===o&&(e&&m(e,l),window.localStorage.removeItem(o),window.localStorage.removeItem(t)),l}catch(e){console.warn(l,"Não foi possível ler parâmetros armazenados.",e)}}return{}}(e);if(!s||!Object.keys(s).length)return void console.log(l,"Nenhum parâmetro rastreado encontrado. Propagação não necessária.");Object.keys(a).length&&(m(e,a),s=a),i=s,console.log(l,"Parâmetros ativos em sessão:",i);const u=()=>{console.log(l,"Iniciando ciclo de propagação para links, botões e forms.");const e=function(e,n){const o=document.getElementsByTagName("a"),t=f(e);if(!t.length)return console.log(l,"Nenhum parâmetro disponível para anexar aos links."),0;let r=0,a=0;for(let i=0;i<o.length;i+=1){const c=o[i];r+=1;const s=c&&"function"==typeof c.getAttribute?c.getAttribute("href"):null;if(s&&!s.startsWith("mailto:")&&!s.startsWith("tel:")&&!s.startsWith("javascript:")&&h(s,n))try{const o=c.hash||"",r=g(s,e,n,t);r&&(c.href=r,o&&c.hash!==o&&(c.hash=o),a+=1)}catch(e){console.warn(l,"Falha ao atualizar URL do link.",e)}}return console.log(l,`Links analisados=${r} atualizados=${a}`),a}(s,n),o=function(e,n){const o=document.getElementsByTagName("button"),t=f(e);if(!t.length)return console.log(l,"Nenhum parâmetro disponível para anexar aos botões."),0;let r=0,a=0;for(let i=0;i<o.length;i+=1){const c=o[i],s=c&&c.onclick;if("function"==typeof s)try{r+=1;const o=s.toString(),i=o.match(/location\.href\s*=\s*['"`]([^'"`]+)['"`]/),l=o.match(/window\.open\s*\(\s*['"`]([^'"`]+)['"`]/),u=i&&i[1]||l&&l[1];if(!u)continue;if(!h(u,n))continue;const f=g(u,e,n,t);if(!f)continue;const d=i&&y(o,s,i[1],f)||l&&y(o,s,l[1],f);d&&(c.onclick=d,a+=1)}catch(e){console.warn(l,"Falha ao inspecionar o handler do botão.",e)}}return console.log(l,`Botões analisados=${r} atualizados=${a}`),a}(s,n),t=function(e){const n=document.getElementsByTagName("form"),o=f(e);if(!o.length)return console.log(l,"Nenhum parâmetro disponível para anexar aos formulários."),0;let t=0,r=0;for(let e=0;e<n.length;e+=1){const a=n[e];t+=1,o.forEach(e=>{if(e&&e.key&&""!==e.value&&!a.querySelector(`input[name="${e.key}"]`))try{const n=document.createElement("input");n.type="hidden",n.name=e.key,n.value=e.value,a.appendChild(n),r+=1}catch(e){console.warn(l,"Falha ao anexar input hidden ao formulário.",e)}})}return console.log(l,`Formulários analisados=${t} inputsIncluídos=${r}`),r}(s);console.log(l,"Propagação finalizada.",`anchors=${e}`,`buttons=${o}`,`forms=${t}`)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u,{once:!0}):u()}()}catch(e){console.error(l,"Erro inesperado durante a inicialização.",e)}}();